{
  "name": "Fluent-plugin-documentdb",
  "tagline": "Azure DocumentDB output plugin for Fluentd",
  "body": "# Azure DocumentDB output plugin for Fluentd\r\n\r\nfluent-plugin-documentdb is a fluent plugin to output to Azure DocumentDB\r\n\r\n![fluent-plugin-documentdb overview](https://github.com/yokawasa/fluent-plugin-documentdb/raw/master/img/fluentd-azure-documentdb-collection.png)\r\n\r\n[NEWS] From fluent-plugin-documentdb-0.2.0, it supports partitioned collections, not only single-partition collections (See [Partitioning and scaling in Azure DocumentDB](https://azure.microsoft.com/en-us/documentation/articles/documentdb-partition-data/#single-partition-and-partitioned-collections) for partitioned collections and single-partition collection ).\r\n\r\n## Installation\r\n\r\n    $ gem install fluent-plugin-documentdb\r\n\r\n## Configuration\r\n\r\n### DocumentDB\r\n\r\nTo use Microsoft Azure DocumentDB, you must create a DocumentDB database account using either the Azure portal, Azure Resource Manager templates, or Azure command-line interface (CLI). In addition, you must have a database and a collection to which fluent-plugin-documentdb writes event-stream out. Here are instructions:\r\n\r\n * Create a DocumentDB database account using [the Azure portal](https://azure.microsoft.com/en-us/documentation/articles/documentdb-create-account/), or [Azure Resource Manager templates and Azure CLI](https://azure.microsoft.com/en-us/documentation/articles/documentdb-automation-resource-manager-cli/)\r\n * [How to create a database for DocumentDB](https://azure.microsoft.com/en-us/documentation/articles/documentdb-create-database/)\r\n * [Create a DocumentDB collection](https://azure.microsoft.com/en-us/documentation/articles/documentdb-create-collection/)\r\n * [Partitioning and scaling in Azure DocumentDB](https://azure.microsoft.com/en-us/documentation/articles/documentdb-partition-data/)\r\n\r\n\r\n### Fluentd - fluent.conf\r\n  \r\n    <match documentdb.*>\r\n        @type documentdb\r\n        docdb_endpoint  DOCUMENTDB_ACCOUNT_ENDPOINT\r\n        docdb_account_key DOCUMENTDB_ACCOUNT_KEY\r\n        docdb_database  mydb\r\n        docdb_collection mycollection\r\n        auto_create_database true\r\n        auto_create_collection true\r\n        partitioned_collection true \r\n        partition_key PARTITION_EKY\r\n        offer_throughput 10100\r\n        time_format %s\r\n        localtime false\r\n        add_time_field true\r\n        time_field_name time\r\n        add_tag_field true\r\n        tag_field_name time\r\n    </match>\r\n\r\n * **docdb\\_endpoint (required)** - Azure DocumentDB Account endpoint URI\r\n * **docdb\\_account\\_key (required)** - Azure DocumentDB Account key (master key). You must NOT set a read-only key\r\n * **docdb\\_database (required)** - DocumentDB database nameb\r\n * **docdb\\_collection (required)** - DocumentDB collection name\r\n * **auto\\_create\\_database (optional)** - Default:true. By default, DocumentDB database named **docdb\\_database** will be automatically created if it does not exist\r\n * **auto\\_create\\_collection (optional)** - Default:true. By default, DocumentDB collection named **docdb\\_collection** will be automatically created if it does not exist\r\n * **partitioned\\_collection (optional)** - Default:false. Set true if you want to create and/or store records to partitioned collection. Set false for single-partition collection\r\n * **partition\\_key (optional)** - Default:nil. Partition key must be specified for paritioned collection (partitioned\\_collection set to be true)\r\n * **offer\\_throughput (optional)** - Default:10100. Throughput for the collection expressed in units of 100 request units per second. This is only effective when you newly create a partitioned collection (ie. Both auto\\_create\\_collection and partitioned\\_collection are set to be true )\r\n * **localtime (optional)** - Default:false. By default, time record is inserted with UTC (Coordinated Universal Time). This option allows to use local time if you set localtime true\r\n * **time\\_format (optional)** -  Default:%s. Time format for a time field to be inserted. Default format is %s, that is unix epoch time. If you want it to be more human readable, set this %Y%m%d-%H:%M:%S, for example.\r\n * **add\\_time\\_field (optional)** - Default:true. This option allows to insert a time field to record\r\n * **time\\_field\\_name (optional)** - Default:time. Time field name to be inserted\r\n * **add\\_tag\\_field (optional)** - Default:true. This option allows to insert a tag field to record\r\n * **tag\\_field\\_name (optional)** - Default:tag. Tag field name to be inserted\r\n\r\n\r\n## Configuration examples\r\n\r\nfluent-plugin-documentdb will add **id** attribute which is UUID format and any other attributes of record automatically. In addition, it will add **time** and **tag** attributes if **add_time_field** and **add_tag_field** are true respectively. Please see 2 types of the plugin configurations example below - single-parition collection and partitioned collection. Source for fluentd to read is apache access log.\r\n\r\n### (1) Single-Partition Collection Case\r\n\r\n<u>fluent.conf</u>\r\n\r\n    <source>\r\n        @type tail                          # input plugin\r\n        path /var/log/apache2/access.log   # monitoring file\r\n        pos_file /tmp/fluentd_pos_file     # position file\r\n        format apache                      # format\r\n        tag documentdb.access              # tag\r\n    </source>\r\n    \r\n    <match documentdb.*>\r\n        @type documentdb\r\n        docdb_endpoint https://yoichikademo.documents.azure.com:443/\r\n        docdb_account_key Tl1xykQxnExUisJ+BXwbbaC8NtUqYVE9kUDXCNust5aYBduhui29Xtxz3DLP88PayjtgtnARc1PW+2wlA6jCJw==\r\n        docdb_database mydb\r\n        docdb_collection my-single-partition-collection\r\n        auto_create_database true\r\n        auto_create_collection true\r\n        partitioned_collection true \r\n        localtime true\r\n        time_format %Y%m%d-%H:%M:%S\r\n        add_time_field true\r\n        time_field_name time\r\n        add_tag_field true\r\n        tag_field_name tag\r\n    </match>\r\n\r\n### (2) Partitioned Collection Case\r\n\r\n<u>fluent.conf</u>\r\n\r\n    <source>\r\n        @type tail                          # input plugin\r\n        path /var/log/apache2/access.log   # monitoring file\r\n        pos_file /tmp/fluentd_pos_file     # position file\r\n        format apache                      # format\r\n        tag documentdb.access              # tag\r\n    </source>\r\n    \r\n    <match documentdb.*>\r\n        @type documentdb\r\n        docdb_endpoint https://yoichikademo.documents.azure.com:443/\r\n        docdb_account_key Tl1xykQxnExUisJ+BXwbbaC8NtUqYVE9kUDXCNust5aYBduhui29Xtxz3DLP88PayjtgtnARc1PW+2wlA6jCJw==\r\n        docdb_database mydb\r\n        docdb_collection my-partitioned-collection\r\n        auto_create_database true\r\n        auto_create_collection true\r\n        partitioned_collection true \r\n        partition_key host\r\n        offer_throughput 10100\r\n        localtime true\r\n        time_format %Y%m%d-%H:%M:%S\r\n        add_time_field true\r\n        time_field_name time\r\n        add_tag_field true\r\n        tag_field_name tag\r\n    </match>\r\n\r\n\r\n## Sample inputs and expected records\r\n\r\nAn expected output record for sample input will be like this:\r\n\r\n<u>Sample Input (apache access log)</u>\r\n\r\n    125.212.152.166 - - [17/Jan/2016:05:03:25 +0000] \"GET /foo/bar/test.html HTTP/1.1\" 304 179 \"-\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36\"\r\n\r\n\r\n<u>Output Record</u>\r\n\r\n    {\r\n        id :  d2b2ece8-b948-41ae-a894-0ed1266e242a,\r\n        host :  125.211.152.166,\r\n        user :  -,\r\n        method :  GET,\r\n        path :  /foo/bar/test.html,\r\n        code :  304,\r\n        size :  179,\r\n        referer :  -,\r\n        agent :  Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36,\r\n        time :  20160117-05:03:25,\r\n        tag :  documentdb.access\r\n    }  \r\n\r\n## Tests\r\n### Running test code\r\n    $ git clone https://github.com/yokawasa/fluent-plugin-documentdb.git\r\n    $ cd fluent-plugin-documentdb\r\n    \r\n    # edit CONFIG params of test/plugin/test_documentdb.rb \r\n    $ vi test/plugin/test_documentdb.rb\r\n    \r\n    # run test \r\n    $ rake test\r\n\r\n### Creating package, running and testing locally \r\n    $ rake build\r\n    $ rake install:local\r\n     \r\n    # running fluentd with your fluent.conf\r\n    $ fluentd -c fluent.conf -vv &\r\n     \r\n    # send test apache requests for testing plugin ( only in the case that input source is apache access log )\r\n    $ ab -n 5 -c 2 http://localhost/foo/bar/test.html\r\n\r\n## TODOs\r\n * Support automatic data expiration with TTL (Time-to-Live ). See [Expire data in DocumentDB collections automatically with time to live](https://azure.microsoft.com/en-us/documentation/articles/documentdb-time-to-live/)\r\n\r\n\r\n## Change log\r\n* [Changelog](ChangeLog.md)\r\n\r\n## Links\r\n\r\n* http://yokawasa.github.io/fluent-plugin-documentdb\r\n* https://rubygems.org/gems/fluent-plugin-documentdb\r\n* http://unofficialism.info/posts/fluent-plugin-azurefunctions/\r\n\r\n\r\n## Contributing\r\n\r\nBug reports and pull requests are welcome on GitHub at https://github.com/yokawasa/fluent-plugin-documentdb.\r\n\r\n## Copyright\r\n\r\n<table>\r\n  <tr>\r\n    <td>Copyright</td><td>Copyright (c) 2016- Yoichi Kawasaki</td>\r\n  </tr>\r\n  <tr>\r\n    <td>License</td><td>Apache License, Version 2.0</td>\r\n  </tr>\r\n</table>\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}